<!DOCTYPE html>
<html>
<head>
    <title>KMS Dispatch Form</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .dashboard {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background-color: #f5f1f1;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
            flex: 1;
            text-align: center;
        }
        .card h4 {
            margin: 0;
            color: #888;
            font-size: 14px;
        }
        .card p {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0 0 0;
            color: #1a73e8;
        }
    </style>
</head>
<body>
    <h2>KMS Dispatch Entry Form</h2>

    <div class="dashboard">
        <div class="card">
            <h4>Total Dispatches</h4>
            <p>{{ total_dispatches }}</p>
        </div>
        <div class="card">
            <h4>Total Quantity</h4>
            <p>{{ total_qty }}</p>
        </div>
        <div class="card">
            <h4>Total Freight</h4>
            <p>â‚¹{{ total_freight }}</p>
        </div>
    </div>

    <form method="POST" action="/submit">
        <label>INV DATE</label><input type="date" name="INV DATE" required>
        <label>INV No</label><input type="text" name="INV No" required>

        <label>CUSTOMER</label>
        <input type="text" name="CUSTOMER" list="customer_list" required>
        <datalist id="customer_list">
            {% for row in data %}
                <option value="{{ row['CUSTOMER'] }}">
            {% endfor %}
        </datalist>

        <label>SALES PERSON</label><input type="text" name="SALES PERSON" required>

        <label>SALE TYPE</label>
        <select name="SALE TYPE" required>
            <option value="cash">Cash</option>
            <option value="credit">Credit</option>
        </select>

        <label>PRODUCT</label>
        <input type="text" name="PRODUCT" list="product_list" required>
        <datalist id="product_list">
            {% for row in data %}
                <option value="{{ row['PRODUCT'] }}">
            {% endfor %}
        </datalist>

        <label>MODEL</label><input type="text" name="MODEL" required>
        <label>COLOUR</label><input type="text" name="COLOUR" required>
        <label>QTY</label><input type="number" name="QTY" required>
        <label>PLACE</label><input type="text" name="PLACE" required>
        <label>DESP DATE</label><input type="date" name="DESP DATE" required>
        <label>DESPATCH TIME</label><input type="time" name="DESPATCH TIME" required>
        <label>TRANSPORT</label><input type="text" name="TRANSPORT" required>
        <label>LR NUMBER</label><input type="text" name="LR NUMBER" required>
        <label>VEHICLE NUMBER</label><input type="text" name="VEHICLE NUMBER" required>

        <label>VEHICLE SIZE</label>
        <select name="VEHICLE SIZE" required>
            <option value="14 feet">14 feet</option>
            <option value="17 feet">17 feet</option>
            <option value="19 feet">19 feet</option>
            <option value="22 feet">22 feet</option>
            <option value="25 feet">25 feet</option>
            <option value="Other">Other</option>
        </select>

        <label>FREIGHT AMT</label><input type="number" name="FREIGHT AMT" required>
        <label>PAYMENT TERMS</label><input type="text" name="PAYMENT TERMS" required>
        <label>PAYMENT STATUS</label>
        <select name="PAYMENT STATUS" required>
            <option value="paid">Paid</option>
            <option value="pending">Pending</option>
        </select>

        <label>REMARKS</label><input type="text" name="REMARKS" required>
        <label>ACKN STATUS</label>
        <select name="ACKN STATUS" required>
            <option value="ok">OK</option>
            <option value="pending">Pending</option>
        </select>

        <label>ACKN SENT DATE</label><input type="date" name="ACKN SENT DATE" required>
        <label>ACKN SENT BY</label><input type="text" name="ACKN SENT BY" required>

        <button type="submit">Submit</button>
    </form>

    <h3>Dispatch Records</h3>
    <input type="text" id="searchInput" class="search-box" onkeyup="filterTable()" placeholder="Search by any field...">

    {% if data|length > 0 %}
    <div style="overflow-x:auto;">
        <table id="dispatchTable">
            <tr>
                {% for col in data[0].keys() %}
                <th>{{ col }}</th>
                {% endfor %}
                <th>Delete</th>
            </tr>
            {% for row in data %}
            <tr>
                {% for val in row.values() %}
                <td>{{ val }}</td>
                {% endfor %}
                <td><a href="/delete/{{ row['S.No'] }}">Delete</a></td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
    <p>No dispatch records yet.</p>
    {% endif %}
    <br>
    <a href="/download"><button>Download Excel</button></a>

    <script>
        function filterTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("dispatchTable");
            tr = table.getElementsByTagName("tr");

            for (i = 1; i < tr.length; i++) {
                tr[i].style.display = "none";
                td = tr[i].getElementsByTagName("td");
                for (var j = 0; j < td.length; j++) {
                    if (td[j]) {
                        txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                            break;
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>
